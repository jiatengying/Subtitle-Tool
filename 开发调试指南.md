

## 项目结构

```
字幕分割/
├── main.py                    # 主程序入口
├── requirements.txt           # 依赖说明
├── 开发调试指南.md            # 本文档
├── parsers/                   # 解析器模块
│   ├── __init__.py
│   ├── srt_parser.py         # SRT文件解析器
│   └── ass_parser.py         # ASS文件解析器
├── splitters/                 # 分割器模块
│   ├── __init__.py
│   └── subtitle_splitter.py  # 字幕分割核心逻辑
├── mergers/                   # 合并器模块
│   ├── __init__.py
│   └── subtitle_merger.py    # 字幕合并核心逻辑
└── ui/                       # 用户界面模块
    ├── __init__.py
    ├── main_window.py        # 主窗口界面
    └── text_compare.py       # 文本对比窗口
```

## 技术栈

- **Python 3.x**：主要编程语言
- **tkinter**：图形用户界面
- **标准库**：os, re, datetime, typing等
- **无第三方依赖**：仅使用Python标准库

## 快速开始

### 环境要求
- Python 3.6 或更高版本
- 支持tkinter的Python环境

### 运行程序
```bash
# 进入项目目录
cd 字幕分割

# 运行主程序
python main.py
```

### 开发环境设置
```bash
# 克隆或下载项目到本地
# 确保Python环境已安装

# 检查Python版本
python --version

# 检查tkinter是否可用
python -c "import tkinter; print('tkinter可用')"
```

## 核心模块详解

### 1. 主程序入口 (`main.py`)

**功能**：程序启动点，创建主窗口并启动GUI

**关键代码**：
```python
def main():
    root = tk.Tk()
    app = MainWindow(root)
    root.mainloop()
```

**调试要点**：
- 检查tkinter是否正确安装
- 确认窗口图标文件是否存在
- 监控主循环是否正常启动

### 2. 主窗口界面 (`ui/main_window.py`)

**功能**：提供完整的图形用户界面

**主要类**：`MainWindow`

**关键方法**：
- `create_widgets()`：创建界面组件
- `switch_function()`：切换功能模块
- `create_split_interface()`：创建分割界面
- `create_merge_interface()`：创建合并界面

**调试要点**：
- 界面布局问题：检查网格配置和权重设置
- 事件绑定：确认按钮点击事件正确绑定
- 状态管理：监控界面状态更新

### 3. 字幕分割器 (`splitters/subtitle_splitter.py`)

**功能**：处理字幕分割的核心业务逻辑

**主要类**：`SubtitleSplitter`

**关键方法**：
- `load_file()`：加载字幕文件
- `split_by_lines()`：按行数分割
- `preview_split()`：预览分割结果

**调试要点**：
- 文件格式检测：确认SRT/ASS格式识别正确
- 分割算法：验证分割逻辑的准确性
- 文件保存：检查输出文件是否正确生成

### 4. 字幕解析器 (`parsers/`)

#### SRT解析器 (`srt_parser.py`)
**功能**：解析SRT格式字幕文件

**关键方法**：
- `parse()`：解析SRT内容
- `generate_srt_content()`：生成SRT文件内容

**调试要点**：
- 时间格式解析：检查时间戳解析是否正确
- 文本内容处理：确认字幕文本正确提取
- 序号处理：验证字幕序号连续性

#### ASS解析器 (`ass_parser.py`)
**功能**：解析ASS格式字幕文件

**关键方法**：
- `parse()`：解析ASS内容
- `generate_ass_content()`：生成ASS文件内容

**调试要点**：
- 样式信息保留：确认[V4+ Styles]部分正确保留
- 脚本信息保留：检查[Script Info]部分处理
- 对话行解析：验证Dialogue行正确解析

### 5. 字幕合并器 (`mergers/subtitle_merger.py`)

**功能**：合并多个字幕文件

**主要类**：`SubtitleMerger`

**关键方法**：
- `merge_files()`：合并文件列表
- `_detect_format()`：检测文件格式

**调试要点**：
- 文件顺序：确认合并顺序正确
- 时间轴处理：检查时间轴连续性
- 格式兼容性：验证不同格式文件的合并

### 6. 文本对比工具 (`ui/text_compare.py`)

**功能**：提供文本差异对比功能

**主要类**：`TextCompareWindow`

**关键方法**：
- `compare_texts()`：对比文本内容
- `apply_highlights()`：应用高亮显示

**调试要点**：
- 字符级对比：验证逐字符对比算法
- 高亮显示：检查差异高亮是否正确
- 同步滚动：确认两个文本框滚动同步

## 调试技巧

### 1. 日志调试
```python
# 在关键位置添加打印语句
print(f"调试信息: {变量名}")

# 使用更详细的日志
import logging
logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)
logger.debug("调试信息")
```

### 2. 异常处理
```python
try:
    # 可能出错的代码
    result = some_function()
except Exception as e:
    print(f"错误详情: {e}")
    # 处理错误
```

### 3. 界面调试
```python
# 检查界面组件状态
print(f"按钮状态: {button['state']}")
print(f"变量值: {var.get()}")

# 强制更新界面
root.update_idletasks()
```

### 4. 文件操作调试
```python
# 检查文件是否存在
if os.path.exists(file_path):
    print(f"文件存在: {file_path}")
else:
    print(f"文件不存在: {file_path}")

# 检查文件内容
with open(file_path, 'r', encoding='utf-8') as f:
    content = f.read()
    print(f"文件内容长度: {len(content)}")
```

## 常见问题及解决方案

### 1. 界面问题

**问题**：界面显示异常或布局错乱
**解决方案**：
- 检查网格权重配置
- 确认组件大小设置
- 验证父容器配置

**问题**：按钮点击无响应
**解决方案**：
- 检查事件绑定
- 确认命令函数存在
- 验证变量作用域

### 2. 文件处理问题

**问题**：文件加载失败
**解决方案**：
- 检查文件编码（UTF-8）
- 验证文件格式
- 确认文件路径正确

**问题**：分割结果不正确
**解决方案**：
- 检查分割算法逻辑
- 验证参数计算
- 确认文件保存路径

### 3. 性能问题

**问题**：处理大文件时界面卡顿
**解决方案**：
- 使用异步处理
- 添加进度条
- 优化算法效率

## 开发建议

### 1. 代码规范
- 使用有意义的变量名
- 添加适当的注释
- 遵循PEP 8编码规范

### 2. 错误处理
- 添加try-catch块
- 提供用户友好的错误信息
- 记录详细的错误日志

### 3. 测试
- 使用不同格式的测试文件
- 测试边界条件
- 验证异常情况处理

### 4. 用户体验
- 提供清晰的操作提示
- 添加进度反馈
- 优化界面响应速度

## 扩展功能建议

### 1. 新功能
- 支持更多字幕格式（VTT、SUB等）
- 添加字幕时间轴调整功能
- 实现字幕样式转换

### 2. 界面改进
- 添加主题切换功能
- 优化移动端适配
- 增加快捷键支持

### 3. 性能优化
- 实现多线程处理
- 添加缓存机制
- 优化内存使用

## 版本历史

- **v1.0**：基础分割功能
- **v2.0**：添加合并和文本对比功能
- **当前版本**：优化界面和字符级对比

## 贡献指南

1. Fork项目
2. 创建功能分支
3. 提交更改
4. 创建Pull Request

## 联系方式

- 开发者：B站阿狗BIGP
- 版本：1.0

---

**注意**：本文档会随着项目更新而持续维护，请定期查看最新版本。
